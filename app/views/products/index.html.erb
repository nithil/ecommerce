<% Category.all.each do |category| %>
	<input type="checkbox" value=<%= category.id %> id="i<%= category.id %>" onchange="math(<%= category.id %>,i<%= category.id %>)"><%= category.name %>
<% end %>
<button id="reset">reset</button><br>
<p>Price</p>
<input type="radio" id="lt250"> (<250)
<input type="radio" id="bw250&750"> (250 - 750)
<input type="radio" id="bw750&1000"> (750 - 1000)
<input type="radio" id="1000+"> (1000+)


<h2><font color="blue"> Listing Products</font></h2>
<% if @products.empty? %>
	<p>No products found</p>
<% else %>	
	<table border="1" id="table">
	<thead>
		<tr>
			<th>#</th>
			<th>Name</th>
			<th>Price</th>
			<th>Category</th>
		</tr>
	</thead>
		<tbody id="body">
			
		</tbody>
</table>
<% end %>

<% if user_signed_in? && current_user.is_admin %>
	<h2><%= link_to "Add Product", new_product_path %></h2>
<% end %>

<script>
	var ids = [];
	var checkedNums = [];
	tableHandle = document.getElementById('table');
	bodyHandle = document.getElementById('body');
	resetHandle = document.getElementById('reset');

	window.addEventListener('load',function(){
		call(ids);
	},false);

	function math(id,check){
		console.log(ids)
		if(check.checked){
			ids.push(id);
			call(ids);
			checkedNums.push(check);
		}else{
			ids.splice(ids.indexOf(id),1);
			call(ids);
		};
	};

	function call(ids){
		var number = 1;
		var xhr = new XMLHttpRequest();
		xhr.open('GET', 'http://localhost:3000/products?category_id='+ids, true);
		xhr.onreadystatechange = function(){
			if(xhr.readyState === 4 && xhr.status === 200){
				var response = JSON.parse(xhr.responseText);
				bodyHandle.innerHTML = "";
				response.forEach(function(n){
					var row = table.insertRow(-1);
    				var cell1 = row.insertCell(0);
    				var cell2 = row.insertCell(1);
    				var cell3 = row.insertCell(2);
    				var cell4 = row.insertCell(3)
    				cell1.innerHTML = number++;
					cell2.innerHTML = n.name;
					cell3.innerHTML = n.price;
					cell4.innerHTML = n.category_name;
					bodyHandle.appendChild(row);
				});
			};
		};
		xhr.send();
	};

	resetHandle.addEventListener('click',function(){
		checkedNums.forEach(function(n){
			n.checked = false;
		})
		ids = [];
		call(ids);
	},false);

</script>